<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5">
<title>HairTattoo ‚Äî Find Scalp Micropigmentation & Hair Tattoo Artists Near You</title>
<meta name="description" content="HairTattoo.com is the #1 directory for scalp micropigmentation (SMP) and hair tattoo professionals. Browse 200+ verified artists across the US. Compare services, pricing, and connect instantly.">
<meta name="keywords" content="hair tattoo, scalp micropigmentation, SMP, hair tattoo near me, scalp tattoo, micropigmentation near me, hair restoration, smp artist, hair loss solution, best hair tattoo, hair tattoo cost">
<link rel="canonical" href="https://hairtattoo.com">
<meta property="og:title" content="HairTattoo ‚Äî Find Hair Tattoo & SMP Artists Near You">
<meta property="og:description" content="The #1 directory for scalp micropigmentation professionals. Browse 200+ verified artists.">
<meta property="og:type" content="website">
<meta property="og:url" content="https://hairtattoo.com">
<meta property="og:site_name" content="HairTattoo">
<meta name="twitter:card" content="summary_large_image">
<meta name="robots" content="index, follow">
<meta name="theme-color" content="#2D5A3D">
<link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üíà</text></svg>">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:opsz,wght@9..40,300;9..40,400;9..40,500;9..40,700&family=Instrument+Serif:ital@0;1&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--bg:#FAFAF8;--card:#FFF;--text:#1A1A1A;--t2:#555;--t3:#888;--ac:#2D5A3D;--ac2:#3A7350;--al:#E8F0EB;--bd:#E8E6E3;--sh:0 1px 3px rgba(0,0,0,.06);--r:12px;--rs:8px;--f:'DM Sans',system-ui,sans-serif;--se:'Instrument Serif',Georgia,serif}
html{font-size:16px;scroll-behavior:smooth}
body{font-family:var(--f);background:var(--bg);color:var(--text);line-height:1.5;-webkit-font-smoothing:antialiased}
a{color:var(--ac);text-decoration:none}
button{font-family:var(--f);cursor:pointer;border:none;background:none}
input,textarea,select{font-family:var(--f);font-size:1rem}

.nav{position:sticky;top:0;z-index:100;background:rgba(250,250,248,.92);backdrop-filter:blur(12px);border-bottom:1px solid var(--bd);padding:0 1rem}
.nav-in{max-width:1200px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;height:56px}
.logo{font-family:var(--se);font-size:1.5rem;color:var(--text);letter-spacing:-.02em;cursor:pointer}
.logo span{color:var(--ac)}
.nav-r{display:flex;gap:.75rem;align-items:center}
.nav-r a{color:var(--t2);font-size:.875rem;font-weight:500;transition:color .15s}
.nav-r a:hover{color:var(--ac)}
.btn{display:inline-flex;align-items:center;gap:.5rem;padding:.5rem 1rem;border-radius:var(--rs);font-size:.875rem;font-weight:500;transition:all .15s}
.btn-p{background:var(--ac);color:#fff}.btn-p:hover{background:var(--ac2)}
.btn-o{border:1px solid var(--bd);color:var(--text)}.btn-o:hover{border-color:var(--ac);color:var(--ac)}

.hero{padding:3rem 1rem 1.5rem;text-align:center;max-width:700px;margin:0 auto}
.hero h1{font-family:var(--se);font-size:clamp(2rem,5vw,3.25rem);font-weight:400;line-height:1.15;margin-bottom:.75rem;letter-spacing:-.02em}
.hero h1 em{font-style:italic;color:var(--ac)}
.hero p{color:var(--t2);font-size:1.0625rem;max-width:520px;margin:0 auto 1.25rem}
.hero-btns{display:flex;gap:.5rem;justify-content:center;flex-wrap:wrap;margin-bottom:.5rem}

.search-wrap{max-width:600px;margin:0 auto 1.5rem;padding:0 1rem}
.search-bar{display:flex;background:var(--card);border:1.5px solid var(--bd);border-radius:var(--r);overflow:hidden;box-shadow:var(--sh);transition:border-color .2s}
.search-bar:focus-within{border-color:var(--ac)}
.search-bar input{flex:1;padding:.75rem 1rem;border:none;outline:none;background:transparent;min-width:0}
.s-loc{border-left:1px solid var(--bd);display:flex;align-items:center;gap:.25rem;padding:0 .75rem;font-size:.875rem;color:var(--t2);min-width:120px}
.s-loc input{padding:.75rem 0;border:none;outline:none;background:transparent;font-size:.875rem;width:100%}
.s-btn{background:var(--ac);color:#fff;padding:.625rem 1rem;font-weight:500;font-size:.875rem;margin:4px;border-radius:var(--rs);white-space:nowrap}
.s-btn:hover{background:var(--ac2)}

.tabs{max-width:1200px;margin:0 auto;padding:0 1rem;display:flex;gap:0;border-bottom:1px solid var(--bd);margin-bottom:1.5rem}
.tab{padding:.75rem 1.25rem;font-size:.875rem;font-weight:500;color:var(--t2);border-bottom:2px solid transparent;transition:all .15s}
.tab:hover{color:var(--text)}.tab.on{color:var(--ac);border-color:var(--ac)}

.filters{max-width:1200px;margin:0 auto 1rem;padding:0 1rem;display:flex;gap:.5rem;flex-wrap:wrap;align-items:center}
.chip{padding:.375rem .75rem;border:1px solid var(--bd);border-radius:20px;font-size:.8125rem;color:var(--t2);background:var(--card);transition:all .15s;white-space:nowrap}
.chip:hover,.chip.on{border-color:var(--ac);color:var(--ac);background:var(--al)}
.fcount{font-size:.8125rem;color:var(--t3);margin-left:auto}

.main{max-width:1200px;margin:0 auto;padding:0 1rem 3rem}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(310px,1fr));gap:1rem}

.card{background:var(--card);border:1px solid var(--bd);border-radius:var(--r);overflow:hidden;transition:box-shadow .15s,transform .1s;cursor:pointer;opacity:0;animation:fadeUp .3s ease forwards}
.card:hover{box-shadow:0 4px 20px rgba(0,0,0,.08);transform:translateY(-2px)}
@keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:none}}
.card:nth-child(1){animation-delay:.02s}.card:nth-child(2){animation-delay:.04s}.card:nth-child(3){animation-delay:.06s}
.card:nth-child(4){animation-delay:.08s}.card:nth-child(5){animation-delay:.1s}.card:nth-child(6){animation-delay:.12s}
.c-head{padding:1.25rem 1.25rem .5rem;display:flex;gap:.75rem;align-items:flex-start}
.c-av{width:44px;height:44px;border-radius:50%;background:var(--al);display:flex;align-items:center;justify-content:center;flex-shrink:0;font-family:var(--se);font-size:1.125rem;color:var(--ac)}
.c-info{flex:1;min-width:0}
.c-name{font-weight:700;font-size:.9375rem;line-height:1.3;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.c-loc{font-size:.8125rem;color:var(--t2);margin-top:1px}
.c-pr{font-size:.8125rem;font-weight:600;color:var(--ac);white-space:nowrap}
.c-body{padding:0 1.25rem .5rem}
.c-about{font-size:.8125rem;color:var(--t2);display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
.c-tags{padding:0 1.25rem .75rem;display:flex;flex-wrap:wrap;gap:.25rem}
.c-tag{font-size:.6875rem;padding:.125rem .5rem;background:var(--al);color:var(--ac);border-radius:4px}
.c-img{position:relative;width:100%;height:180px;overflow:hidden;background:var(--al)}
.c-img img{width:100%;height:100%;object-fit:cover;display:block}
.c-pill{position:absolute;bottom:8px;left:8px;background:rgba(255,255,255,.85);backdrop-filter:blur(4px);padding:2px 8px;border-radius:12px;font-size:.625rem;color:var(--t2);pointer-events:none}
.c-foot{padding:.5rem 1.25rem;border-top:1px solid var(--bd);display:flex;align-items:center;justify-content:space-between;font-size:.8125rem}
.c-views{color:var(--t3);display:flex;align-items:center;gap:.25rem;font-size:.75rem}
.c-msg{color:var(--ac);font-weight:500;display:flex;align-items:center;gap:.25rem;cursor:pointer;transition:color .15s}
.c-msg:hover{color:var(--ac2)}
.msg-overlay{display:none;position:fixed;inset:0;z-index:200;background:rgba(0,0,0,.4)}
.msg-overlay.open{display:block}
.msg-panel{position:fixed;top:0;right:-420px;width:400px;max-width:90vw;height:100vh;background:var(--card);z-index:201;box-shadow:-4px 0 20px rgba(0,0,0,.1);transition:right .3s ease;display:flex;flex-direction:column;overflow:hidden}
.msg-panel.open{right:0}
.msg-panel-head{padding:1.25rem;border-bottom:1px solid var(--bd);display:flex;align-items:center;justify-content:space-between}
.msg-panel-head h3{font-size:1rem;font-weight:700}
.msg-panel-body{flex:1;overflow-y:auto;padding:1.25rem}
.msg-panel-body label.mp-label{display:block;font-size:.8125rem;font-weight:500;margin-bottom:.25rem;color:var(--text)}
.msg-panel-body input[type="text"],.msg-panel-body input[type="tel"],.msg-panel-body textarea{width:100%;padding:.625rem .75rem;border:1px solid var(--bd);border-radius:var(--rs);outline:none;font-size:.875rem;margin-bottom:.75rem;transition:border-color .15s;font-family:var(--f);background:#fff}
.msg-panel-body input:focus,.msg-panel-body textarea:focus{border-color:var(--ac)}
.msg-panel-body textarea{resize:vertical;min-height:80px}
.msg-svcs{display:flex;flex-wrap:wrap;gap:.375rem;margin-bottom:.75rem}
.msg-svc{font-size:.75rem;padding:.25rem .625rem;border:1px solid var(--bd);border-radius:20px;cursor:pointer;transition:all .15s;background:var(--card);color:var(--t2)}
.msg-svc.on{border-color:var(--ac);background:var(--al);color:var(--ac)}
.msg-consent{display:flex;align-items:flex-start;gap:.5rem;margin-bottom:1rem;font-size:.75rem;color:var(--t2)}
.msg-consent input[type="checkbox"]{margin-top:2px;flex-shrink:0}
.msg-submit{width:100%;padding:.75rem;background:var(--ac);color:#fff;border-radius:var(--rs);font-weight:600;font-size:.875rem;transition:background .15s}
.msg-submit:hover{background:var(--ac2)}
.msg-ok{text-align:center;padding:2rem 1rem}
.msg-ok h4{font-size:1.125rem;margin-bottom:.5rem;color:var(--ac)}
.msg-ok p{color:var(--t2);font-size:.875rem;margin-bottom:1rem}

/* MASONRY FEED */
.masonry{columns:4;column-gap:6px;max-width:1200px;margin:0 auto;padding:0 1rem 3rem}
.m-item{break-inside:avoid;margin-bottom:6px;border-radius:8px;overflow:hidden;position:relative;cursor:pointer}
.m-item:hover .m-ov{opacity:1}
.m-img{width:100%;display:block;background:linear-gradient(135deg,var(--al),#c8dbd0);min-height:160px;object-fit:cover}
.m-ov{position:absolute;inset:0;background:linear-gradient(transparent 40%,rgba(0,0,0,.65));opacity:0;transition:opacity .2s;display:flex;flex-direction:column;justify-content:flex-end;padding:.75rem}
.m-ov-name{color:#fff;font-weight:700;font-size:.8125rem;line-height:1.3}
.m-ov-loc{color:rgba(255,255,255,.75);font-size:.6875rem}
.m-dots{position:absolute;bottom:.5rem;left:50%;transform:translateX(-50%);display:flex;gap:4px;z-index:1}
.m-dot{width:5px;height:5px;border-radius:50%;background:rgba(255,255,255,.5)}.m-dot.on{background:#fff}

/* DETAIL PAGE */
.detail-page{display:none;max-width:720px;margin:0 auto;padding:1rem 1rem 3rem}
.dp-back{font-size:.875rem;color:var(--t2);display:inline-flex;align-items:center;gap:.375rem;margin-bottom:1.25rem;padding:.375rem 0}
.dp-back:hover{color:var(--ac)}
.dp-header{display:flex;gap:1.25rem;align-items:flex-start;margin-bottom:1.5rem}
.dp-av{width:80px;height:80px;border-radius:50%;background:var(--al);display:flex;align-items:center;justify-content:center;font-family:var(--se);font-size:2rem;color:var(--ac);flex-shrink:0}
.dp-info{flex:1;min-width:0}
.dp-name{font-size:1.5rem;font-weight:700;line-height:1.2;margin-bottom:.25rem}
.dp-loc{color:var(--t2);font-size:.9375rem;margin-bottom:.25rem}
.dp-price{color:var(--ac);font-weight:600;font-size:.875rem}
.dp-socials{display:flex;gap:.5rem;margin-top:.5rem}
.dp-social{display:inline-flex;align-items:center;gap:.25rem;padding:.25rem .625rem;background:var(--al);border-radius:20px;font-size:.75rem;font-weight:500;color:var(--ac);transition:all .15s}
.dp-social:hover{background:var(--ac);color:#fff}
.dp-claim{background:linear-gradient(135deg,var(--ac),var(--ac2));color:#fff;padding:.75rem 1rem;border-radius:var(--rs);display:flex;align-items:center;gap:.75rem;font-size:.8125rem;margin-bottom:1.25rem}
.dp-claim button{background:rgba(255,255,255,.2);color:#fff;padding:.25rem .75rem;border-radius:4px;font-size:.8125rem;font-weight:500;white-space:nowrap}
.dp-claim button:hover{background:rgba(255,255,255,.35)}
.dp-section{background:var(--card);border:1px solid var(--bd);border-radius:var(--r);padding:1.25rem;margin-bottom:1rem}
.dp-section h3{font-size:.6875rem;text-transform:uppercase;letter-spacing:.08em;color:var(--t3);margin-bottom:.625rem;font-weight:600}
.dp-about{font-size:.9375rem;color:var(--t2);line-height:1.7}
.dp-svcs{display:flex;flex-wrap:wrap;gap:.375rem}
.dp-svcs span{font-size:.8125rem;padding:.25rem .75rem;background:var(--al);color:var(--ac);border-radius:6px}
.dp-grid{display:grid;grid-template-columns:1fr 1fr;gap:.75rem}
.dp-det label{display:block;font-size:.6875rem;color:var(--t3);text-transform:uppercase;letter-spacing:.04em;margin-bottom:2px}
.dp-det a{color:var(--ac);word-break:break-all;font-size:.875rem}
.dp-det span{font-size:.875rem;color:var(--text)}

/* CONTACT FORM */
.cf{background:var(--card);border:1px solid var(--bd);border-radius:var(--r);padding:1.25rem;margin-bottom:1rem}
.cf h3{font-size:.9375rem;font-weight:700;color:var(--ac);margin-bottom:.75rem}
.cf-row{display:flex;gap:.5rem;margin-bottom:.5rem}
.cf-row input,.cf-row textarea{flex:1;padding:.625rem .75rem;border:1px solid var(--bd);border-radius:var(--rs);outline:none;font-size:.875rem;background:#fff;transition:border-color .15s}
.cf-row input:focus,.cf-row textarea:focus{border-color:var(--ac)}
.cf-row textarea{resize:vertical;min-height:72px}
.cf-sub{width:100%;padding:.625rem;background:var(--ac);color:#fff;border-radius:var(--rs);font-weight:600;font-size:.875rem}
.cf-sub:hover{background:var(--ac2)}
.cf-ok{text-align:center;padding:.75rem;color:var(--ac);font-weight:500;font-size:.875rem}

footer{background:var(--text);color:#ccc;padding:3rem 1rem;text-align:center;font-size:.8125rem}
footer h4{font-family:var(--se);font-size:1.25rem;color:#fff;margin-bottom:.5rem}
footer p{max-width:500px;margin:0 auto .75rem;line-height:1.6}
.f-links{display:flex;gap:1.5rem;justify-content:center;margin-top:1rem;flex-wrap:wrap}
.f-links a{color:#aaa;font-size:.8125rem}.f-links a:hover{color:#fff}

.empty{text-align:center;padding:3rem 1rem;color:var(--t2)}
.empty h3{font-size:1.125rem;margin-bottom:.5rem;color:var(--text)}

.pager{display:flex;justify-content:center;gap:.5rem;padding:2rem 0}
.pager button{padding:.375rem .75rem;border:1px solid var(--bd);border-radius:var(--rs);font-size:.875rem;color:var(--t2);background:var(--card)}
.pager button:hover{border-color:var(--ac);color:var(--ac)}
.pager button.on{background:var(--ac);color:#fff;border-color:var(--ac)}

.icon{width:16px;height:16px;fill:none;stroke:currentColor;stroke-width:2;stroke-linecap:round;stroke-linejoin:round;vertical-align:middle}
@keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}
@keyframes shimmer{0%{background-position:-400px 0}100%{background-position:400px 0}}
.skel{background:linear-gradient(90deg,var(--bd) 25%,#f0eeeb 50%,var(--bd) 75%);background-size:800px 100%;animation:shimmer 1.5s infinite;border-radius:var(--r);height:220px}

@media(max-width:768px){
  .masonry{columns:2;column-gap:4px}
  .m-item{margin-bottom:4px}
}
@media(max-width:640px){
  .hero h1{font-size:1.75rem}
  .search-bar{flex-wrap:wrap}
  .s-loc{border-left:0;border-top:1px solid var(--bd);width:100%}
  .s-btn{width:calc(100% - 8px)}
  .grid{grid-template-columns:1fr}
  .masonry{columns:2;column-gap:3px}
  .m-item{margin-bottom:3px;border-radius:4px}
  .nav-r .hm{display:none}
  .filters{overflow-x:auto;flex-wrap:nowrap;scrollbar-width:none}
  .filters::-webkit-scrollbar{display:none}
  .dp-header{flex-direction:column;align-items:center;text-align:center}
  .dp-grid{grid-template-columns:1fr}
  .dp-socials{justify-content:center}
}
/* LIGHTBOX */
.lb{display:none;position:fixed;inset:0;z-index:300;background:rgba(0,0,0,.92);justify-content:center;align-items:center;flex-direction:column;padding:1rem}
.lb.open{display:flex}
.lb-img{max-width:90vw;max-height:70vh;border-radius:8px;object-fit:contain;background:linear-gradient(135deg,var(--al),#c8dbd0);min-width:280px;min-height:280px;display:flex;align-items:center;justify-content:center;flex-direction:column}
.lb-info{text-align:center;margin-top:1rem;color:#fff}
.lb-info h4{font-size:1rem;font-weight:600;margin-bottom:.25rem}
.lb-info p{font-size:.8125rem;color:rgba(255,255,255,.7);margin-bottom:.75rem}
.lb-info .btn{background:rgba(255,255,255,.15);color:#fff;border:1px solid rgba(255,255,255,.25);backdrop-filter:blur(4px)}
.lb-info .btn:hover{background:rgba(255,255,255,.25)}
.lb-close{position:absolute;top:1rem;right:1rem;width:40px;height:40px;border-radius:50%;background:rgba(255,255,255,.1);color:#fff;font-size:1.5rem;display:flex;align-items:center;justify-content:center}
.lb-close:hover{background:rgba(255,255,255,.2)}
.lb-nav{position:absolute;top:50%;transform:translateY(-50%);width:40px;height:40px;border-radius:50%;background:rgba(255,255,255,.1);color:#fff;font-size:1.25rem;display:flex;align-items:center;justify-content:center}
.lb-nav:hover{background:rgba(255,255,255,.2)}
.lb-prev{left:1rem}.lb-next{right:1rem}
</style>
</head>
<body>
<nav class="nav"><div class="nav-in">
  <div class="logo" onclick="goHome()">Hair<span>Tattoo</span></div>
  <div class="nav-r">
    <a href="#" onclick="event.preventDefault();goHome();showTab('directory')" class="hm">Directory</a>
    <a href="#" onclick="event.preventDefault();goHome();showTab('feed')" class="hm">Explore</a>
    <a href="/signup.html" class="btn btn-p">List Your Business</a>
  </div>
</div></nav>

<!-- HOME VIEW -->
<div id="homeView">
  <section class="hero">
    <h1>Find a <em>Hair Tattoo</em> Artist Near You</h1>
    <p>The #1 directory for scalp micropigmentation professionals. Browse 350+ verified SMP artists, compare services, and connect instantly.</p>
    <div class="hero-btns">
      <button class="btn btn-o" onclick="geoSort()" id="nearMeBtn" style="font-size:.8125rem">
        <svg class="icon" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><polygon points="16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76"/></svg> Near Me
      </button>
      <button class="btn btn-o" onclick="showTab('feed')" style="font-size:.8125rem">
        <svg class="icon" viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg> Browse Results
      </button>
    </div>
  </section>
  <div class="search-wrap">
    <div class="search-bar">
      <input type="text" id="searchName" placeholder="Search artist or studio name..." oninput="doSearch()">
      <div class="s-loc">
        <svg class="icon" style="width:14px;height:14px;flex-shrink:0" viewBox="0 0 24 24"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>
        <input type="text" id="searchCity" placeholder="City or State" oninput="doSearch()">
      </div>
      <button class="s-btn" onclick="doSearch()">Search</button>
    </div>
  </div>
  <div class="tabs">
    <button class="tab on" onclick="showTab('directory')" id="tabDir">Directory</button>
    <button class="tab" onclick="showTab('feed')" id="tabFeed">Explore</button>
  </div>
  <div id="dirView">
    <div class="filters" id="filters">
      <button class="chip on" onclick="setFilter('all')">All</button>
      <button class="chip" onclick="setFilter('Hairline Restoration')">Hairline</button>
      <button class="chip" onclick="setFilter('Density Fill')">Density</button>
      <button class="chip" onclick="setFilter('Scar Camouflage')">Scar Camo</button>
      <button class="chip" onclick="setFilter('Female SMP')">Female SMP</button>
      <button class="chip" onclick="setFilter('Beard SMP')">Beard SMP</button>
      <button class="chip" onclick="setFilter('Alopecia Treatment')">Alopecia</button>
      <button class="chip" onclick="setFilter('$$$')">Premium $$$</button>
      <button class="chip" onclick="setFilter('$$')">Standard $$</button>
      <span class="fcount" id="resultCount"></span>
    </div>
    <div class="main"><div class="grid" id="listGrid"><div class="skel"></div><div class="skel"></div><div class="skel"></div><div class="skel"></div><div class="skel"></div><div class="skel"></div></div></div>
    <div class="pager" id="pager"></div>
  </div>
  <div id="feedView" style="display:none">
    <div class="masonry" id="masonryGrid"></div>
  </div>
</div>

<!-- DETAIL PAGE (hash routed) -->
<div class="detail-page" id="detailPage"></div>

<!-- SIGNUP MODAL -->
<!-- LIGHTBOX -->
<div class="lb" id="lightbox" onclick="if(event.target===this)closeLb()">
  <button class="lb-close" onclick="closeLb()">√ó</button>
  <button class="lb-nav lb-prev" onclick="lbNav(-1)">‚Äπ</button>
  <button class="lb-nav lb-next" onclick="lbNav(1)">‚Ä∫</button>
  <div class="lb-img" id="lbImg"></div>
  <div class="lb-info" id="lbInfo"></div>
</div>

<!-- MESSAGE PANEL -->
<div class="msg-overlay" id="msgOverlay" onclick="closeMsgPanel()"></div>
<div class="msg-panel" id="msgPanel">
  <div class="msg-panel-head">
    <h3 id="msgPanelTitle">Send a Message</h3>
    <button onclick="closeMsgPanel()" style="font-size:1.25rem;color:var(--t3);line-height:1">&times;</button>
  </div>
  <div class="msg-panel-body" id="msgPanelBody"></div>
</div>

<footer>
  <h4>Hair<span style="color:var(--al)">Tattoo</span></h4>
  <p>The #1 directory for scalp micropigmentation and hair tattoo professionals in the United States. Connecting people with trusted SMP artists since 2025.</p>
  <div style="margin:1.5rem auto;max-width:700px;text-align:left">
    <p style="font-size:.6875rem;color:#888;margin-bottom:.5rem;text-transform:uppercase;letter-spacing:.06em">Popular Cities</p>
    <div style="display:flex;flex-wrap:wrap;gap:.375rem" id="footerCities"></div>
  </div>
  <p style="font-size:.75rem;margin-top:1rem">¬© 2025 HairTattoo.com. All rights reserved.</p>
  <div class="f-links">
    <a href="#">About</a><a href="#">For Professionals</a><a href="#">Privacy</a><a href="#">Terms</a><a href="mailto:hello@hairtattoo.com">Contact</a>
  </div>
</footer>

<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebSite","name":"HairTattoo","alternateName":"HairTattoo.com","url":"https://hairtattoo.com","description":"The #1 directory for scalp micropigmentation and hair tattoo professionals","potentialAction":{"@type":"SearchAction","target":"https://hairtattoo.com/?q={search_term_string}","query-input":"required name=search_term_string"}}
</script>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
<script>
const SB=window.supabase.createClient('https://ingorrzmoudvoknhwjjb.supabase.co','eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImluZ29ycnptb3Vkdm9rbmh3ampiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA2NDY1NTIsImV4cCI6MjA4NjIyMjU1Mn0.rpcraVuvgRWX1NJtZyUQAzDp4rZhw4cpRm4dRx9yxJc');
const MEDIA_BASE='https://ingorrzmoudvoknhwjjb.supabase.co/storage/v1/object/public/placeholders/';
function mediaUrl(p){return MEDIA_BASE+encodeURIComponent(p);}
let L=[];
const _viewedAt={};
function trackView(listing){
  const now=Date.now();
  if(_viewedAt[listing.id]&&now-_viewedAt[listing.id]<30000)return;
  _viewedAt[listing.id]=now;
  SB.from('page_views').insert({listing_id:listing.id,path:'/#/'+listing.slug}).then(()=>{});
}

let filtered=[],currentFilter='all',page=1,currentTab='directory';
const PER=24;

// === HASH ROUTER ===
function route(){
  const hash=location.hash.slice(1);
  if(hash && hash!=='/'){
    const slug=hash.startsWith('/')?hash.slice(1):hash;
    const listing=L.find(l=>l.slug===slug);
    if(listing){showDetail(listing);return;}
  }
  showHome();
}
window.addEventListener('hashchange',route);

function goHome(){location.hash='';showHome();}

function showHome(){
  document.getElementById('homeView').style.display='';
  document.getElementById('detailPage').style.display='none';
  document.title='HairTattoo ‚Äî Find Hair Tattoo & SMP Artists Near You';
}

// === DISTANCE ===
function dist(a,b,c,d){const R=3959,x=(c-a)*Math.PI/180,y=(d-b)*Math.PI/180;const s=Math.sin(x/2)**2+Math.cos(a*Math.PI/180)*Math.cos(c*Math.PI/180)*Math.sin(y/2)**2;return R*2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s));}

// === SEARCH ===
function doSearch(){
  const q=(document.getElementById('searchName').value||'').toLowerCase().trim();
  const loc=(document.getElementById('searchCity').value||'').toLowerCase().trim();
  filtered=L.filter(l=>{
    let m=true;
    if(q) m=l.name.toLowerCase().includes(q)||l.about.toLowerCase().includes(q);
    if(loc&&m) m=l.city.toLowerCase().includes(loc)||l.state.toLowerCase()===loc||(l.city+', '+l.state).toLowerCase().includes(loc);
    if(currentFilter!=='all'&&m){
      if(currentFilter==='$$$'||currentFilter==='$$') m=(l.pr)===currentFilter;
      else m=l.services.includes(currentFilter);
    }
    return m;
  });
  page=1;render();
}

function setFilter(f){
  currentFilter=f;
  document.querySelectorAll('.chip').forEach(c=>{
    const t=c.textContent;
    c.classList.toggle('on',f==='all'?t==='All':t.includes(f)||(f==='$$$'&&t.includes('Premium'))||(f==='$$'&&t.includes('Standard')));
  });
  doSearch();
}

// === GEO ===
function geoSort(){
  if(!navigator.geolocation)return;
  const b=document.getElementById('nearMeBtn');
  if(b)b.innerHTML='<span style="display:inline-block;animation:spin .8s linear infinite">‚ü≥</span> Locating...';
  navigator.geolocation.getCurrentPosition(p=>{
    L.forEach(l=>l._dist=dist(p.coords.latitude,p.coords.longitude,l.lat,l.lng));
    L.sort((a,b)=>(a._dist||9999)-(b._dist||9999));
    if(b)b.innerHTML='<svg class="icon" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><polygon points="16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76"/></svg> Near Me ‚úì';
    doSearch();
  },()=>{if(b)b.textContent='Location unavailable';});
}

// === RENDER DIRECTORY ===
function render(){
  const g=document.getElementById('listGrid'),s=(page-1)*PER,items=filtered.slice(s,s+PER);
  document.getElementById('resultCount').textContent=filtered.length+' artist'+(filtered.length!==1?'s':'');
  if(!items.length){g.innerHTML='<div class="empty" style="grid-column:1/-1"><h3>No artists found</h3><p>Try adjusting your search or filters</p></div>';document.getElementById('pager').innerHTML='';return;}
  g.innerHTML=items.map(l=>{
    const ini=l.name.split(' ').map(w=>w[0]).slice(0,2).join('');
    const pr=l.pr||'$$';
    const d=l._dist?'<span style="margin-left:.25rem;font-size:.7rem;color:var(--t3)">'+Math.round(l._dist)+' mi</span>':'';
    const thumb=l._media&&l._media[0]?`<div class="c-img"><img src="${mediaUrl(l._media[0].storage_path)}" loading="lazy" width="400" height="180" alt="${l.name} SMP">${l._media[0].is_placeholder?'<span class="c-pill">üì∑ Sample photo</span>':''}</div>`:'';
    return `<article class="card" onclick="location.hash='/${l.slug}'" itemscope itemtype="https://schema.org/LocalBusiness">
      ${thumb}
      <div class="c-head"><div class="c-av">${ini}</div><div class="c-info"><div class="c-name" itemprop="name">${l.name}</div><div class="c-loc"><svg class="icon" style="width:12px;height:12px" viewBox="0 0 24 24"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg> <span itemprop="address">${l.city}, ${l.state}</span>${d}</div></div><div class="c-pr">${pr}</div></div>
      <div class="c-body"><p class="c-about" itemprop="description">${l.about}</p></div>
      <div class="c-tags">${l.services.slice(0,3).map(s=>'<span class="c-tag">'+s+'</span>').join('')}</div>
      <div class="c-foot"><span class="c-views">${l._views?'üëÅ '+l._views+' view'+(l._views!==1?'s':''):'New'}</span><span class="c-msg" onclick="event.stopPropagation();openMsgPanel(${l.id})"><svg class="icon" style="width:14px;height:14px" viewBox="0 0 24 24"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg> Message</span></div>
    </article>`;
  }).join('');
  // pager
  const pages=Math.ceil(filtered.length/PER),pg=document.getElementById('pager');
  if(pages<=1){pg.innerHTML='';return;}
  let h='';
  if(page>1)h+='<button onclick="goPage('+(page-1)+')">‚Üê Prev</button>';
  const start=Math.max(1,page-3),end=Math.min(pages,start+6);
  for(let i=start;i<=end;i++)h+='<button class="'+(i===page?'on':'')+'" onclick="goPage('+i+')">'+i+'</button>';
  if(page<pages)h+='<button onclick="goPage('+(page+1)+')">Next ‚Üí</button>';
  pg.innerHTML=h;
}
function goPage(p){page=p;render();window.scrollTo({top:document.querySelector('.tabs').offsetTop-60,behavior:'smooth'});}

// === DETAIL PAGE ===
function showDetail(l){
  document.getElementById('homeView').style.display='none';
  const dp=document.getElementById('detailPage');
  dp.style.display='block';
  window.scrollTo(0,0);
  document.title=l.name+' ‚Äî Hair Tattoo & SMP | HairTattoo.com';
  trackView(l);

  const ini=l.name.split(' ').map(w=>w[0]).slice(0,2).join('');
  const pr=l.pr||'$$';
  const soc=l.socials||{};

  // Build social links
  let socHTML='';
  if(soc.instagram) socHTML+=`<a href="https://instagram.com/${soc.instagram}" target="_blank" rel="noopener" class="dp-social"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="2" width="20" height="20" rx="5"/><circle cx="12" cy="12" r="5"/><circle cx="17.5" cy="6.5" r="1.5"/></svg> @${soc.instagram}</a>`;
  if(soc.facebook) socHTML+=`<a href="https://facebook.com/${soc.facebook}" target="_blank" rel="noopener" class="dp-social"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"/></svg> Facebook</a>`;
  if(soc.tiktok) socHTML+=`<a href="https://tiktok.com/@${soc.tiktok}" target="_blank" rel="noopener" class="dp-social">TikTok</a>`;
  if(l.website) socHTML+=`<a href="${l.website}" target="_blank" rel="noopener" class="dp-social"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg> Website</a>`;

  // Gallery images from media table
  const gMedia=l._media||[];
  let gallery='';
  if(gMedia.length){
    gallery=gMedia.map((m,i)=>`<div onclick="openLb(${l.id},${i})" style="border-radius:8px;overflow:hidden;position:relative;cursor:pointer;transition:transform .15s" onmouseover="this.style.transform='scale(1.03)'" onmouseout="this.style.transform=''"><img src="${mediaUrl(m.storage_path)}" loading="lazy" width="240" height="200" alt="${l.name}" style="width:100%;height:200px;object-fit:cover;display:block">${m.is_placeholder?'<span class="c-pill">üì∑ Sample photo</span>':''}</div>`).join('');
  } else {
    const colors=['#c8dbd0','#b8d0c2','#a8c5b4','#d4e4d9','#e0ebe5','#bcd4c6'];
    const glabels=['Before & After','Hairline Closeup','Density Session','Side Profile','Top View','Final Result'];
    for(let i=0;i<6;i++){
      gallery+=`<div style="background:${colors[i]};border-radius:8px;height:200px;display:flex;align-items:center;justify-content:center;flex-direction:column;color:var(--ac)"><span style="font-family:var(--se);font-size:1.5rem;opacity:.5">${ini}</span><span style="font-size:.6rem;opacity:.35;margin-top:.25rem">${glabels[i]}</span></div>`;
    }
  }

  dp.innerHTML=`
    <button class="dp-back" onclick="goHome()"><svg class="icon" viewBox="0 0 24 24"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg> Back to directory</button>
    <div class="dp-header">
      <div class="dp-av">${ini}</div>
      <div class="dp-info">
        <h1 class="dp-name">${l.name}</h1>
        <div class="dp-loc">${l.address}, ${l.city}, ${l.state} ${l.zip}</div>
        <div class="dp-price">${pr} ¬∑ Scalp Micropigmentation</div>
        <div class="dp-socials">${socHTML}</div>
      </div>
    </div>
    <div class="dp-section"><h3>About</h3><p class="dp-about">${l.about}</p></div>
    <div class="dp-section"><h3>Services Offered</h3><div class="dp-svcs">${l.services.map(s=>'<span>'+s+'</span>').join('')}</div></div>
    <div class="dp-section"><h3>Contact Information</h3><div class="dp-grid">
      <div class="dp-det"><label>Phone</label><a href="tel:${l.phone}">${l.phone}</a></div>
      <div class="dp-det"><label>Email</label><a href="mailto:${l.email}">${l.email}</a></div>
      <div class="dp-det"><label>Website</label><a href="${l.website}" target="_blank" rel="noopener">${l.website.replace(/https?:\/\//,'')}</a></div>
      <div class="dp-det"><label>Location</label><span>${l.city}, ${l.state} ${l.zip}</span></div>
    </div></div>
    <div class="dp-section"><h3>Gallery</h3><div style="display:grid;grid-template-columns:repeat(3,1fr);gap:6px">${gallery}</div><p style="font-size:.75rem;color:var(--t3);margin-top:.5rem;text-align:center">${l.claimed?'':'Photos will appear when this business claims their page'}</p></div>
    <div class="cf" id="cf-${l.id}">
      <h3>üì© Send a Message to ${l.name}</h3>
      <div class="cf-row"><input type="text" placeholder="Your Name" id="cfn-${l.id}"><input type="tel" placeholder="Your Phone" id="cfp-${l.id}"></div>
      <div class="cf-row"><textarea placeholder="Hi, I'm interested in learning more about your SMP services..." id="cfm-${l.id}"></textarea></div>
      <button class="cf-sub" onclick="sendMsg(${l.id})">Send Message ‚Üí</button>
    </div>
    ${!l.claimed?`<div class="dp-claim"><span style="flex:1">Is this your business? Claim it to manage your listing.</span><button onclick="location.href='/signup.html?claim=${l.slug}'">Claim Page</button></div>`:''}
  `;

  // Inject structured data for this listing
  let sd=document.getElementById('listing-sd');
  if(sd)sd.remove();
  sd=document.createElement('script');sd.type='application/ld+json';sd.id='listing-sd';
  sd.textContent=JSON.stringify({"@context":"https://schema.org","@type":"LocalBusiness","name":l.name,"address":{"@type":"PostalAddress","streetAddress":l.address,"addressLocality":l.city,"addressRegion":l.state,"postalCode":l.zip,"addressCountry":"US"},"telephone":l.phone,"email":l.email,"url":l.website,"description":l.about,"geo":{"@type":"GeoCoordinates","latitude":l.lat,"longitude":l.lng},"makesOffer":l.services.map(s=>({"@type":"Offer","itemOffered":{"@type":"Service","name":s}}))});
  document.head.appendChild(sd);
}

async function sendMsg(id){
  const n=document.getElementById('cfn-'+id)?.value;
  const p=document.getElementById('cfp-'+id)?.value;
  const m=document.getElementById('cfm-'+id)?.value||'';
  if(!n||!p){alert('Please enter your name and phone number.');return;}
  const{error}=await SB.from('leads').insert({listing_id:id,sender_name:n,sender_phone:p,sender_message:m||null});
  if(error)console.error('Lead insert error:',error.message);
  document.getElementById('cf-'+id).innerHTML='<div class="cf-ok">‚úì Message sent! The artist will reach out to you shortly.</div>';
}

// === MESSAGE PANEL ===
let msgListingId=null;
function openMsgPanel(id){
  const l=L.find(x=>x.id===id);if(!l)return;
  msgListingId=id;
  document.getElementById('msgPanelTitle').textContent='Message '+l.name;
  const svcs=l.services.map(s=>`<span class="msg-svc" onclick="this.classList.toggle('on')">${s}</span>`).join('');
  document.getElementById('msgPanelBody').innerHTML=`
    <label class="mp-label">Your Name</label>
    <input type="text" id="mpName" placeholder="Full name">
    <label class="mp-label">Phone Number</label>
    <input type="tel" id="mpPhone" placeholder="(555) 123-4567">
    <label class="mp-label">Services Interested In</label>
    <div class="msg-svcs">${svcs}</div>
    <label class="mp-label">Message</label>
    <textarea id="mpMsg" placeholder="Hi, I'm interested in learning more about your SMP services..."></textarea>
    <label class="msg-consent"><input type="checkbox" id="mpConsent"> I agree to receive SMS/text messages from this business regarding my inquiry. Message & data rates may apply.</label>
    <button class="msg-submit" onclick="submitMsgPanel()">Send Message ‚Üí</button>
  `;
  document.getElementById('msgOverlay').classList.add('open');
  document.getElementById('msgPanel').classList.add('open');
  document.body.style.overflow='hidden';
}
function closeMsgPanel(){
  document.getElementById('msgOverlay').classList.remove('open');
  document.getElementById('msgPanel').classList.remove('open');
  document.body.style.overflow='';
  msgListingId=null;
}
async function submitMsgPanel(){
  const name=document.getElementById('mpName')?.value?.trim();
  const phone=document.getElementById('mpPhone')?.value?.trim();
  const msg=document.getElementById('mpMsg')?.value?.trim();
  const svcs=[...document.querySelectorAll('.msg-svc.on')].map(s=>s.textContent);
  if(!name||!phone){alert('Please enter your name and phone number.');return;}
  const fullMsg=(svcs.length?'Services: '+svcs.join(', ')+'\n\n':'')+(msg||'');
  const{error}=await SB.from('leads').insert({listing_id:msgListingId,sender_name:name,sender_phone:phone,sender_message:fullMsg||null});
  if(error){console.error('Lead insert error:',error.message);alert('Something went wrong. Please try again.');return;}
  document.getElementById('msgPanelBody').innerHTML='<div class="msg-ok"><h4>‚úì Message Sent!</h4><p>The artist will reach out to you shortly.</p><button class="btn btn-o" onclick="closeMsgPanel()">Close</button></div>';
}

// === LIGHTBOX ===
let lbItems=[],lbIdx=0;
function openLb(listingId,idx){
  const l=L.find(x=>x.id===listingId);if(!l)return;
  const media=l._media||[];
  if(media.length){
    lbItems=media.map(m=>({url:mediaUrl(m.storage_path),isPlaceholder:m.is_placeholder,listing:l}));
  } else {
    const ini=l.name.split(' ').map(w=>w[0]).slice(0,2).join('');
    const colors=['#c8dbd0','#b8d0c2','#a8c5b4','#d4e4d9','#e0ebe5','#bcd4c6'];
    lbItems=colors.map((c,i)=>({color:c,ini,listing:l}));
  }
  lbIdx=idx||0;
  renderLb();
  document.getElementById('lightbox').classList.add('open');
  document.body.style.overflow='hidden';
}
function openLbFeed(listingId){
  openLb(listingId,0);
}
function renderLb(){
  const item=lbItems[lbIdx];if(!item)return;
  const imgEl=document.getElementById('lbImg');
  if(item.url){
    imgEl.style.background='#111';
    imgEl.innerHTML=`<img src="${item.url}" alt="${item.listing.name}" style="max-width:90vw;max-height:70vh;object-fit:contain;border-radius:8px">${item.isPlaceholder?'<span class="c-pill" style="bottom:1rem;left:1rem">üì∑ Sample photo</span>':''}`;
  } else {
    imgEl.style.background=`linear-gradient(135deg,${item.color},#c8dbd0)`;
    imgEl.innerHTML=`<span style="font-family:var(--se);font-size:3rem;color:var(--ac);opacity:.4">${item.ini}</span>`;
  }
  const dots=lbItems.length>1?`<div style="display:flex;gap:4px;justify-content:center;margin-top:.5rem">${lbItems.map((_,i)=>`<span style="width:6px;height:6px;border-radius:50%;background:${i===lbIdx?'#fff':'rgba(255,255,255,.4)'}"></span>`).join('')}</div>`:'';
  document.getElementById('lbInfo').innerHTML=`<h4>${item.listing.name}</h4><p>${item.listing.city}, ${item.listing.state}</p>${dots}<button class="btn" onclick="closeLb();location.hash='/${item.listing.slug}'" style="margin-top:.5rem">View Business ‚Üí</button>`;
}
function closeLb(){document.getElementById('lightbox').classList.remove('open');document.body.style.overflow='';}
function lbNav(dir){lbIdx=(lbIdx+dir+lbItems.length)%lbItems.length;renderLb();}

// === MASONRY FEED ===
function showTab(t){
  currentTab=t;
  document.getElementById('tabDir').classList.toggle('on',t==='directory');
  document.getElementById('tabFeed').classList.toggle('on',t==='feed');
  document.getElementById('dirView').style.display=t==='directory'?'':'none';
  document.getElementById('feedView').style.display=t==='feed'?'':'none';
  if(t==='feed')renderMasonry();
}

function renderMasonry(){
  const items=L.filter(l=>l.about.length>30).sort(()=>Math.random()-.5).slice(0,80);
  const g=document.getElementById('masonryGrid');
  const colors=['#c8dbd0','#b8d0c2','#a8c5b4','#d4e4d9','#bcd4c6','#96b8a5','#aecabb','#d0ddd5','#c2d6cc','#b0c9b9'];
  const heights=[180,220,260,200,300,240,280,190,250,210,270,230];
  const labels=['Before & After','Hairline Design','Density Session','Scar Camouflage','Fresh Results','Client Transformation','Natural Finish','SMP Artistry'];

  g.innerHTML=items.map((l,i)=>{
    const ini=l.name.split(' ').map(w=>w[0]).slice(0,2).join('');
    const h=heights[i%heights.length]+(i%3)*20;
    const c=colors[i%colors.length];
    const mg=l._media&&l._media[0];
    const hasMulti=l._media&&l._media.length>1;
    const dots=hasMulti?`<div class="m-dots">${l._media.slice(0,6).map((_,j)=>'<span class="m-dot'+(j===0?' on':'')+'"></span>').join('')}</div>`:'';
    const imgHTML=mg?`<img class="m-img" src="${mediaUrl(mg.storage_path)}" loading="lazy" width="300" height="${h}" alt="${l.name}" style="height:100%;width:100%;object-fit:cover">`:`<div class="m-img" style="height:100%;background:linear-gradient(${135+i*15}deg,${c},${colors[(i+3)%colors.length]});display:flex;align-items:center;justify-content:center;flex-direction:column"><span style="font-family:var(--se);font-size:2rem;color:var(--ac);opacity:.4">${ini}</span></div>`;
    return `<div class="m-item" onclick="openLbFeed(${l.id})" style="height:${h}px">
      ${imgHTML}
      ${mg&&mg.is_placeholder?'<span class="c-pill" style="position:absolute;bottom:2.5rem;left:.5rem">üì∑ Sample photo</span>':''}
      ${dots}
      <div class="m-ov">
        <div class="m-ov-name">${l.name}</div>
        <div class="m-ov-loc">${l.city}, ${l.state}</div>
      </div>
    </div>`;
  }).join('');
}

// === SIGNUP ===
// Moved to /signup.html (multi-step page builder)

// === INIT ===
async function initApp(){
  // Fetch listings from Supabase
  const{data,error}=await SB.from('listings').select('*');
  if(error){console.error('Failed to load listings:',error.message);document.getElementById('listGrid').innerHTML='<div class="empty" style="grid-column:1/-1"><h3>Failed to load listings</h3><p>Please refresh the page</p></div>';return;}
  // Map DB columns to app format
  L=data.map(r=>({
    id:r.id,name:r.name,slug:r.slug,city:r.city,state:r.state,
    address:r.address||'',zip:r.zip||'',phone:r.phone||'',email:r.email||'',
    website:r.website||'',lat:r.lat,lng:r.lng,about:r.about||'',
    services:r.services||[],pr:r.price_range||'$$',claimed:r.claimed||false,
    socials:{instagram:r.instagram||'',facebook:r.facebook||'',tiktok:r.tiktok||''}
  }));
  // Fetch view counts
  const{data:viewStats,error:vsErr}=await SB.from('listing_stats').select('id,view_count');
  if(!vsErr&&viewStats){const vc={};viewStats.forEach(s=>vc[s.id]=s.view_count||0);L.forEach(l=>l._views=vc[l.id]||0);}
  // Fetch media for all listings
  const{data:mediaData}=await SB.from('media').select('*').order('sort_order',{ascending:true});
  if(mediaData){const mm={};mediaData.forEach(m=>{if(!mm[m.listing_id])mm[m.listing_id]=[];mm[m.listing_id].push(m);});L.forEach(l=>l._media=mm[l.id]||[]);}
  filtered=[...L];
  doSearch();
  geoSort();
  // Footer city links
  const topC=['New York, NY','Los Angeles, CA','Houston, TX','Chicago, IL','Miami Beach, FL','Atlanta, GA','Phoenix, AZ','Dallas, TX','San Francisco, CA','Seattle, WA','Boston, MA','Denver, CO','Austin, TX','Nashville, TN','Tampa, FL','Fort Lauderdale, FL','San Diego, CA','Philadelphia, PA','Charlotte, NC','Las Vegas, NV','Portland, OR','Scottsdale, AZ','Boca Raton, FL','Fort Worth, TX','Beverly Hills, CA'];
  const fc=document.getElementById('footerCities');
  if(fc)fc.innerHTML=topC.map(c=>`<a href="#" onclick="event.preventDefault();document.getElementById('searchCity').value='${c.split(',')[0]}';goHome();showTab('directory');doSearch()" style="font-size:.75rem;color:#aaa;padding:.25rem .5rem;border:1px solid #444;border-radius:4px;white-space:nowrap">${c}</a>`).join('');
  // Schema for top listings
  L.slice(0,20).forEach(l=>{const s=document.createElement('script');s.type='application/ld+json';s.textContent=JSON.stringify({"@context":"https://schema.org","@type":"LocalBusiness","name":l.name,"address":{"@type":"PostalAddress","streetAddress":l.address,"addressLocality":l.city,"addressRegion":l.state,"postalCode":l.zip},"telephone":l.phone,"url":l.website,"geo":{"@type":"GeoCoordinates","latitude":l.lat,"longitude":l.lng}});document.head.appendChild(s);});
  // Route
  route();
  // Auth-aware nav
  SB.auth.onAuthStateChange((ev,session)=>{
    const navR=document.querySelector('.nav-r');
    const listBtn=navR.querySelector('.btn-p');
    if(session&&session.user&&listBtn){
      const em=session.user.email||'';
      const ini=em.split('@')[0].slice(0,2).toUpperCase();
      listBtn.outerHTML=`<a href="/dashboard.html" style="display:flex;align-items:center;gap:.5rem;font-size:.875rem;font-weight:500;color:var(--text)"><span style="width:32px;height:32px;border-radius:50%;background:var(--al);display:flex;align-items:center;justify-content:center;font-size:.75rem;font-weight:700;color:var(--ac)">${ini}</span>Dashboard</a>`;
    }
  });
}
document.addEventListener('DOMContentLoaded',()=>initApp());

document.addEventListener('keydown',e=>{
  if(e.key==='Escape'){closeMsgPanel();closeLb();}
  if(document.getElementById('lightbox').classList.contains('open')){
    if(e.key==='ArrowLeft')lbNav(-1);
    if(e.key==='ArrowRight')lbNav(1);
  }
});
</script>
</body>
</html>
