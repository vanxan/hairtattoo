<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Leave a Review â€” Hair Tattoo</title>
<link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ’ˆ</text></svg>">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:opsz,wght@9..40,300;9..40,400;9..40,500;9..40,700&family=Instrument+Serif:ital@0;1&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--bg:#FAFAF8;--card:#FFF;--text:#1A1A1A;--t2:#555;--t3:#888;--ac:#2D5A3D;--ac2:#3A7350;--al:#E8F0EB;--bd:#E8E6E3;--sh:0 1px 3px rgba(0,0,0,.06);--r:12px;--rs:8px;--f:'DM Sans',system-ui,sans-serif;--se:'Instrument Serif',Georgia,serif}
html{font-size:16px}
body{font-family:var(--f);background:var(--bg);color:var(--text);line-height:1.5;-webkit-font-smoothing:antialiased}
a{color:var(--ac);text-decoration:none}
button{font-family:var(--f);cursor:pointer;border:none;background:none}
input,textarea{font-family:var(--f);font-size:1rem}

.nav{position:sticky;top:0;z-index:100;background:rgba(250,250,248,.92);backdrop-filter:blur(12px);border-bottom:1px solid var(--bd);padding:0 1rem}
.nav-in{max-width:1200px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;height:56px}
.logo{font-family:var(--se);font-size:1.5rem;color:var(--text);letter-spacing:-.02em}
.logo span{color:var(--ac)}
.nav-r{display:flex;gap:.75rem;align-items:center}
.nav-r a{color:var(--t2);font-size:.875rem;font-weight:500}

.review-page{max-width:560px;margin:0 auto;padding:2rem 1rem}
.rp-loading{text-align:center;padding:3rem;color:var(--t3)}
.rp-error{text-align:center;padding:3rem;color:#DC2626}

.rp-header{text-align:center;margin-bottom:2rem}
.rp-av{width:64px;height:64px;border-radius:50%;background:var(--al);display:flex;align-items:center;justify-content:center;font-size:1.25rem;font-weight:700;color:var(--ac);margin:0 auto .75rem}
.rp-header h1{font-family:var(--se);font-size:1.5rem;font-weight:400}
.rp-header p{color:var(--t2);font-size:.875rem;margin-top:.25rem}

.rp-form{background:var(--card);border:1px solid var(--bd);border-radius:var(--r);padding:1.5rem}

/* Star selector */
.star-select{display:flex;gap:.5rem;justify-content:center;margin-bottom:1.5rem}
.star-btn{font-size:2rem;color:var(--bd);cursor:pointer;transition:color .15s;padding:0;line-height:1}
.star-btn.on{color:#F59E0B}
.star-btn:hover{color:#F59E0B}

.fg{display:flex;flex-direction:column;margin-bottom:1rem}
.fg label{font-size:.75rem;font-weight:600;color:var(--t3);text-transform:uppercase;letter-spacing:.04em;margin-bottom:.25rem}
.fg input,.fg textarea{padding:.625rem .75rem;border:1px solid var(--bd);border-radius:var(--rs);outline:none;font-size:.875rem;background:#fff;transition:border-color .15s}
.fg input:focus,.fg textarea:focus{border-color:var(--ac)}
.fg textarea{resize:vertical;min-height:120px}
.fg .hint{font-size:.6875rem;color:var(--t3);margin-top:.25rem}

.submit-btn{width:100%;padding:.75rem;background:var(--ac);color:#fff;border:none;border-radius:var(--rs);font-size:.875rem;font-weight:500;cursor:pointer;transition:background .15s;margin-top:.5rem}
.submit-btn:hover{background:var(--ac2)}
.submit-btn:disabled{opacity:.5;cursor:not-allowed}

.rp-success{text-align:center;padding:3rem 1rem}
.rp-success h2{font-size:1.25rem;margin-bottom:.5rem;color:var(--ac)}
.rp-success p{color:var(--t2);font-size:.875rem}

.footer{text-align:center;padding:2rem 1rem;border-top:1px solid var(--bd);margin-top:3rem;color:var(--t3);font-size:.75rem}
.footer a{color:var(--t2)}
</style>
</head>
<body>

<nav class="nav"><div class="nav-in">
  <a href="/" class="logo">Hair<span>Tattoo</span></a>
  <div class="nav-r"><a href="/near-me/">Near Me</a></div>
</div></nav>

<div class="review-page">
  <div class="rp-loading" id="rpLoading">Loading business info...</div>
  <div class="rp-error" id="rpError" style="display:none"></div>

  <div id="rpContent" style="display:none">
    <div class="rp-header">
      <div class="rp-av" id="rpAvatar"></div>
      <h1>Leave a review for <span id="rpBizName"></span></h1>
      <p id="rpBizLoc"></p>
    </div>

    <div class="rp-form" id="rpForm">
      <div style="text-align:center;margin-bottom:.5rem;font-size:.8125rem;color:var(--t2)">How was your experience?</div>
      <div class="star-select" id="starSelect">
        <span class="star-btn" data-val="1" onclick="setRating(1)">&#9733;</span>
        <span class="star-btn" data-val="2" onclick="setRating(2)">&#9733;</span>
        <span class="star-btn" data-val="3" onclick="setRating(3)">&#9733;</span>
        <span class="star-btn" data-val="4" onclick="setRating(4)">&#9733;</span>
        <span class="star-btn" data-val="5" onclick="setRating(5)">&#9733;</span>
      </div>
      <div class="fg">
        <label>Review Title <span style="font-weight:400;text-transform:none">(optional)</span></label>
        <input type="text" id="rvTitle" placeholder="Summarize your experience">
      </div>
      <div class="fg">
        <label>Your Review</label>
        <textarea id="rvBody" placeholder="Tell us about your experience..."></textarea>
      </div>
      <div class="fg">
        <label>Your Name <span style="color:#DC2626">*</span></label>
        <input type="text" id="rvName" placeholder="John D." required>
      </div>
      <div class="fg">
        <label>Your Email <span style="font-weight:400;text-transform:none">(optional)</span></label>
        <input type="email" id="rvEmail" placeholder="you@email.com">
        <span class="hint">We'll never share this publicly</span>
      </div>
      <button class="submit-btn" id="submitBtn" onclick="submitReview()">Submit Review</button>
      <div id="rvMsg" style="text-align:center;font-size:.8125rem;margin-top:.75rem"></div>
    </div>

    <div class="rp-success" id="rpSuccess" style="display:none">
      <h2>Thank you for your review!</h2>
      <p>It will appear on their page after a quick verification.</p>
      <a href="/" style="display:inline-block;margin-top:1rem" class="submit-btn" style="width:auto;padding:.5rem 1.5rem">Back to Hair Tattoo</a>
    </div>
  </div>
</div>

<div class="footer">
  <a href="/">Hair Tattoo</a> &mdash; Find SMP artists near you
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
<script>
const SB_URL='https://ingorrzmoudvoknhwjjb.supabase.co';
const SB_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImluZ29ycnptb3Vkdm9rbmh3ampiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA2NDY1NTIsImV4cCI6MjA4NjIyMjU1Mn0.rpcraVuvgRWX1NJtZyUQAzDp4rZhw4cpRm4dRx9yxJc';
const SB=window.supabase.createClient(SB_URL,SB_KEY);

let listing=null;
let selectedRating=0;

function setRating(n){
  selectedRating=n;
  document.querySelectorAll('.star-btn').forEach(s=>{
    s.classList.toggle('on',parseInt(s.dataset.val)<=n);
  });
}

async function init(){
  const params=new URLSearchParams(window.location.search);
  const slug=params.get('listing');
  if(!slug){
    document.getElementById('rpLoading').style.display='none';
    document.getElementById('rpError').style.display='block';
    document.getElementById('rpError').textContent='No business specified. Please use a review link from your SMP artist.';
    return;
  }

  const{data,error}=await SB.from('listings').select('id,name,city,state,slug').eq('slug',slug).limit(1).maybeSingle();
  document.getElementById('rpLoading').style.display='none';

  if(!data){
    document.getElementById('rpError').style.display='block';
    document.getElementById('rpError').textContent='Business not found. Please check your review link.';
    return;
  }

  listing=data;
  const ini=data.name.split(' ').map(w=>w[0]).slice(0,2).join('');
  document.getElementById('rpAvatar').textContent=ini;
  document.getElementById('rpBizName').textContent=data.name;
  document.getElementById('rpBizLoc').textContent=data.city+', '+data.state;
  document.getElementById('rpContent').style.display='block';
}

async function submitReview(){
  const name=document.getElementById('rvName').value.trim();
  const email=document.getElementById('rvEmail').value.trim();
  const title=document.getElementById('rvTitle').value.trim();
  const body=document.getElementById('rvBody').value.trim();
  const msg=document.getElementById('rvMsg');

  if(!selectedRating){msg.innerHTML='<span style="color:#DC2626">Please select a star rating.</span>';return;}
  if(!name){msg.innerHTML='<span style="color:#DC2626">Please enter your name.</span>';return;}

  const btn=document.getElementById('submitBtn');
  btn.disabled=true;
  btn.textContent='Submitting...';

  const{error}=await SB.from('reviews').insert({
    listing_id:listing.id,
    reviewer_name:name,
    reviewer_email:email||null,
    rating:selectedRating,
    title:title||null,
    body:body||null,
    status:'pending'
  });

  if(error){
    msg.innerHTML='<span style="color:#DC2626">Error: '+error.message+'</span>';
    btn.disabled=false;
    btn.textContent='Submit Review';
    return;
  }

  document.getElementById('rpForm').style.display='none';
  document.getElementById('rpSuccess').style.display='block';
}

init();
</script>
</body>
</html>
